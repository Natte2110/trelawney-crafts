{% extends "base.html" %} {% block content %}
<header class="masthead gallery"></header>

<div class="container px-4 px-lg-5 gallery-intro">
  <div
    class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center"
  >
    <div class="col-lg-8 align-self-end">
      <h1 class="text-white font-weight-bold">Welcome To The Gallery</h1>
      <hr class="divider" />
    </div>
    <div class="col-lg-8 align-self-baseline">
      <p class="text-white-75 mb-5">
        Posts made by other users will appear here, just scroll down to explore
        some of them.
      </p>
      <a class="btn btn-primary btn-xl" href="{{ url_for('upload') }}"
        >Post Your Own Piece</a
      >
    </div>
  </div>
</div>

<div class="container-xl px-4 mt-4 gallery-posts">
  {% for post in posts %}
  <div id="{{ post.id }}" class="post">
    <div class="post-title">{{ post.title }}</div>

    <img
      class=""
      src="{{ url_for('static', filename=path+'/'+post.image_url)}}"
      alt=""
    />
    <div class="post-information">{{ post.user }}: {{ post.content }}</div>
    <div class="post-actions">
      {% if current_user.id in post.liked_by %}
      <div id="{{ post.id }}" class="post-like liked">
        <i class="bi bi-hand-thumbs-up">{{ post.like_count }}</i>
      </div>
      {% else %}
      <div id="{{ post.id }}" class="post-like">
        <i class="bi bi-hand-thumbs-up">{{ post.like_count }}</i>
      </div>
      {% endif %}
      <div class="post-comment"><i class="bi bi-chat-right-dots"></i> 0</div>
    </div>
  </div>
  {% endfor %}
</div>
<script>
  var postLikeDiv = document.querySelectorAll(".post-like");

  postLikeDiv.forEach(function (element) {
    element.addEventListener("click", function () {
      if (element.classList[1] == "liked") {
        element.classList.remove("liked");
        fetch(`/remove_reaction/${element.id}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json" // Set the content type based on your API requirements
            // Add any additional headers if needed
          } // Convert the data to JSON format
        }).then(setTimeout(()=>{
          fetch(`/reaction_count/${element.id}`)
            .then((response) => response.json())
            .then((responseData) => {
              console.log(responseData);
              element.childNodes[1].innerHTML = responseData;
            })
            .catch((error) => console.warn(error))
          }, 100
        )
        )
          
      } else {
        element.classList.add("liked");
        fetch(`/add_reaction/${element.id}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json" // Set the content type based on your API requirements
            // Add any additional headers if needed
          } // Convert the data to JSON format
        }).then(setTimeout(()=>{
          fetch(`/reaction_count/${element.id}`)
            .then((response) => response.json())
            .then((responseData) => {
              console.log(responseData);
              element.childNodes[1].innerHTML = responseData;
            })
            .catch((error) => console.warn(error))
          }, 100
        )
        )
      }
    });
  });
</script>
{% endblock %}
